# PeSIT Server HA - Enterprise Integration Test Values
global:
  imagePullSecrets:
    - name: ghcr-secret

api:
  replicaCount: 2
  
  image:
    repository: ghcr.io/pesitwizard/pesitwizard-enterprise/pesitwizard-server
    tag: latest
    pullPolicy: Always
  
  springProfiles: "default"
  vectisPort: 5000
  jgroupsPort: 7800
  
  vectisService:
    type: NodePort
    port: 5000
    nodePort: 30500
    sessionAffinity: true
  
  database:
    embedded: false
    host: postgresql
    port: 5432
    name: pesitwizard
    username: pesitwizard
    existingSecret: pesitwizard-server-db
    existingSecretKey: password
  
  postgresql:
    enabled: false
  
  cluster:
    enabled: true
    jgroups:
      discoveryProtocol: kubernetes
      namespace: pesitwizard
      configFile: "kube.xml"
  
  tls:
    enabled: false
  
  pesitwizard:
    serverId: "PESIT-HA-CLUSTER"
    protocolVersion: 2
    maxConnections: 100
    connectionTimeout: 30000
    readTimeout: 60000
  
  storage:
    mountPath: /data/vectis
    receiveDirectory: /data/received
    sendDirectory: /data/send
  
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  
  livenessProbe:
    initialDelaySeconds: 120
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 5
  
  readinessProbe:
    initialDelaySeconds: 60
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 10
  
  # Security settings for multi-pod encryption
  security:
    # Master key for AES encryption
    masterKey: "integration-test-master-key-32b!"
    # Shared salt for HA deployments - all pods MUST use the same value
    # Generate with: openssl rand -base64 32
    encryptionSalt: "dGVzdC1pbnRlZ3JhdGlvbi1zYWx0LTMyYnl0ZXMhIQ=="

  extraEnv:
    - name: SPRING_DATASOURCE_DRIVER_CLASS_NAME
      value: "org.postgresql.Driver"
    - name: SPRING_JPA_DATABASE_PLATFORM
      value: "org.hibernate.dialect.PostgreSQLDialect"
    - name: LOGGING_LEVEL_ROOT
      value: "INFO"
    - name: PESIT_SECURITY_ENABLED
      value: "false"

serviceAccount:
  create: true

persistence:
  enabled: false

podSecurityContext:
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1000

# Vectis Client Configuration

spring:
  application:
    name: pesitwizard-client
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:nosecurity}

  # Database configuration
  datasource:
    url: jdbc:h2:file:./data/pesitwizard-client;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password:
  
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    open-in-view: false
    properties:
      jakarta:
        persistence:
          jdbc:
            url: jdbc:h2:file:./data/pesitwizard-client;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE

  # H2 Console
  h2:
    console:
      enabled: true
      path: /h2-console

  # Security - OAuth2/OIDC (configure for production)
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: ${OAUTH2_JWK_SET_URI:}

# Server configuration
server:
  port: ${SERVER_PORT:8080}
  error:
    # Do not include stack traces in error responses (security)
    include-stacktrace: never
    # Include error message in responses
    include-message: always
    # Include binding errors in responses
    include-binding-errors: always

# Actuator endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true
    db:
      enabled: false
  # OTLP metrics - disabled by default, enable with OTEL_EXPORTER_OTLP_ENDPOINT
  otlp:
    metrics:
      export:
        enabled: ${OTEL_METRICS_ENABLED:false}
        url: ${OTEL_EXPORTER_OTLP_ENDPOINT:}
    tracing:
      export:
        enabled: ${OTEL_TRACING_ENABLED:false}
        endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:}

# OpenTelemetry - only active when endpoint is configured
otel:
  exporter:
    otlp:
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:}
  service:
    name: ${spring.application.name}

# Vectis client defaults
pesitwizard:
  client:
    id: ${PESIT_CLIENT_ID:PESIT_CLIENT}
    strict-mode: false
    connection-timeout: 30000
    read-timeout: 60000
    retry-count: 3
    retry-delay: 5000
    receive-directory: ./received

# Logging
logging:
  level:
    root: WARN
    com.pesitwizard: ${LOG_LEVEL:INFO}
    org.springframework.security: WARN
  pattern:
    console: "%d{HH:mm:ss} %-5level [%X{traceId:-}] %msg%n"
